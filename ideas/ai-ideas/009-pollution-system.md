# Система загрязнения

## Описание
Здания производят загрязнение (pollution), которое распространяется по карте облаком. Высокое загрязнение:
- Привлекает врагов
- Провоцирует атаки на фабрику
- Можно снизить с помощью деревьев и фильтров

Визуально отображается красным туманом/overlay.

## Оценка сложности
**Высокая (8/10)**

- Система распространения pollution (диффузия по карте)
- Поглощение деревьями и фильтрами
- Визуализация (overlay/heatmap)
- Влияние на спавн врагов
- Оптимизация (pollution для больших карт)

## Оценка интересности
**Высокая (8/10)**

Создаёт экологическую механику. Заставляет балансировать производство и защиту. Добавляет стратегический выбор (эффективность vs чистота).

## Краткий план реализации

1. **Pollution source**:
   - entity_type: добавить поле pollution_per_second
   - Примеры:
     - Drill: 10 pollution/min
     - Furnace: 4 pollution/min
     - Assembler: 3 pollution/min
     - Boiler: 30 pollution/min (очень грязный)
     - Solar Panel: 0 pollution/min (чистый)

2. **Карта pollution**:
   - Сетка pollution chunks (32x32 тайла каждый)
   - Каждый chunk имеет pollution_level (0-1000+)
   - Обновление каждые 1-2 секунды

3. **Распространение** (диффузия):
   - Каждый тик:
     - Pollution перетекает в соседние chunks (10% от разницы)
     - Естественное рассеивание (-2 pollution/min)
     - Поглощение деревьями

4. **Деревья**:
   - Каждое дерево поглощает 0.1 pollution/sec в chunk
   - Если pollution > 100, дерево начинает умирать
   - Мёртвое дерево не поглощает

5. **Фильтры**:
   - entity_type "Air Filter"
   - Поглощает 50 pollution/sec в радиусе
   - Требует электричество + фильтрующий элемент (расходник)
   - Производит "грязные фильтры" (можно переработать)

6. **Влияние на врагов**:
   - Спавн врагов зависит от pollution в chunk
   - Если pollution > 500 в chunk → враги начинают атаки
   - Pollution > 1000 → массированные атаки
   - Враги идут к источнику загрязнения

7. **Визуализация**:
   - Overlay режим "Загрязнение" (кнопка в UI)
   - Heatmap: зелёный (чисто) → жёлтый → красный (грязно)
   - Полупрозрачный красный туман над грязными chunk
   - Opacity зависит от pollution_level

8. **UI индикатор**:
   - Текущий уровень pollution в месте игрока
   - Общий pollution production (units/min)
   - Общий pollution consumption (деревья, фильтры)

9. **Оптимизация**:
   - Не обновлять chunks далеко от фабрики
   - Только видимые chunks отрисовываются
   - Упрощённая физика диффузии

10. **Альтернативные источники энергии**:
    - Солнечные панели: 0 pollution
    - Ветряки: 0 pollution
    - Ядерный реактор: 0 pollution (но радиация)
    - Стимул переходить на чистую энергию
