# Копирование целых участков (Advanced Copy-Paste)

## Описание
Расширение системы чертежей:
- Копировать целый участок базы (здания + настройки)
- Вырезать (cut) участок → перенести в другое место
- Вставлять с ротацией (поворот на 90°, 180°, 270°)
- Зеркалирование (flip horizontal/vertical)
- Предпросмотр перед вставкой

## Оценка сложности
**Средняя (6/10)**

- Расширение blueprint системы
- Rotation/flip логика для всех entity_type
- Ghost entities с трансформациями
- Undo/Redo для операций
- UI для выбора режима

## Оценка интересности
**Очень высокая (9/10)**

Резко ускоряет строительство. Позволяет быстро создавать симметричные дизайны. Упрощает реорганизацию базы.

## Краткий план реализации

1. **Hotkeys**:
   - Ctrl+C: Copy selection
   - Ctrl+X: Cut selection (удаляет оригинал)
   - Ctrl+V: Paste
   - R: Rotate clockwise (при paste)
   - Shift+R: Rotate counter-clockwise
   - F: Flip horizontal
   - Shift+F: Flip vertical

2. **Selection mode**:
   - Drag для выделения прямоугольной области
   - Визуальная рамка (синий пунктир)
   - Показать количество зданий: "15 entities selected"

3. **Copy**:
   - Сохранить все entities в выделении
   - Координаты относительные (от центра выделения)
   - Настройки каждого здания (рецепты, фильтры, etc.)
   - В clipboard (глобальная переменная)

4. **Cut**:
   - Copy + немедленное удаление
   - Возврат ресурсов (как при deconstruction)
   - Или: не возвращать ресурсы (они "в буфере")

5. **Paste**:
   - Ghost entities в месте курсора
   - Центр выделения следует за курсором
   - Полупрозрачные sprites
   - Показать коллизии (красный если нельзя поставить)

6. **Rotation**:
   - При нажатии R: повернуть все entities на 90°
   - Координаты пересчитываются:
     ```javascript
     // Rotate 90° clockwise
     newX = -oldY
     newY = oldX
     ```
   - Направление конвейеров также поворачивается

7. **Flip**:
   - Horizontal flip: x = -x
   - Vertical flip: y = -y
   - Направления также инвертируются

8. **Предпросмотр**:
   - Зелёные ghost: можно поставить
   - Красные ghost: коллизия/нельзя
   - Показать стоимость (общая сумма ресурсов)
   - Shift: показать сетку привязки (snap to grid)

9. **Snap to grid**:
   - При paste: автоматически выравнивать по сетке
   - Можно отключить (hold Alt)
   - Полезно для аккуратных дизайнов

10. **Undo/Redo**:
    - Ctrl+Z: отменить последнюю операцию
    - Ctrl+Y: повторить
    - История последних 10 операций
    - Стек: `[{type: 'paste', entities: [...], position: {x, y}}]`

11. **Сохранение в библиотеку**:
    - После выделения: кнопка "Save as Blueprint"
    - Ввести название → сохранить в библиотеку
    - Можно использовать позже

12. **Массовое размещение**:
    - После paste: не подтверждать сразу
    - Можно перемещать, вращать, двигать
    - Клик → подтвердить и разместить
    - Или перейти в другое место и paste снова

13. **Template mode**:
    - Shift+V: paste как template (многократно)
    - Каждый клик → вставить копию
    - Полезно для создания рядов одинаковых структур

14. **Учёт настроек**:
    - При paste: применить все настройки оригиналов
    - Рецепты, фильтры, модули
    - Условия circuit network
    - Train schedules
