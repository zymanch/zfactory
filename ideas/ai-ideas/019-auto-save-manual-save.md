# Автосохранение и ручное сохранение

## Описание
Система сохранения прогресса:
- Автосохранение каждые N минут
- Ручное сохранение (кнопка или Ctrl+S)
- Несколько слотов сохранений
- Загрузка сохранений
- Экспорт/импорт сохранений (backup)

## Оценка сложности
**Средняя (5/10)**

- Сериализация всего состояния игры
- Система слотов сохранений
- Автосохранение (таймер)
- UI для управления сохранениями
- Компрессия данных (если много)

## Оценка интересности
**Критично (10/10)**

Абсолютная необходимость. Без этого игра непригодна к использованию.

## Краткий план реализации

1. **Что сохранять**:
   - user: current_region_id, position
   - map: все тайлы
   - entity: все здания + состояния
   - user_resource: ресурсы в главном здании
   - user_technology: исследованные технологии
   - statistics: статистика (опционально, только агрегированная)
   - quickbar: настройки quickbar
   - blueprints: сохранённые чертежи

2. **Автосохранение**:
   - Интервал: каждые 5 минут (настраивается)
   - Background save: не блокировать игру
   - Индикатор: "Saving..." в углу экрана (2 секунды)
   - Ротация: хранить последние 3 автосохранения

3. **Ручное сохранение**:
   - Hotkey: Ctrl+S
   - Кнопка в меню: "Save Game"
   - Сохранение в отдельный слот
   - Можно ввести название save

4. **Слоты сохранений**:
   - 10 слотов для ручных сохранений
   - 3 слота для автосохранений (ротация)
   - Каждый слот показывает:
     - Дата и время
     - Название (если есть)
     - Скриншот (опционально)
     - Общее время игры
     - Прогресс (количество технологий, зданий)

5. **База данных**:
   - Таблица `save_game`:
     - id, user_id, slot_number, name, created_at
     - play_time (секунды)
     - is_autosave (boolean)

   - При сохранении:
     - Snapshot всех данных пользователя
     - Или: использовать текущие данные как "active save"
     - Слоты = копии активного save в определённый момент

6. **Вариант 1: Multiple databases**:
   - Каждое сохранение = отдельная копия данных
   - save_1_map, save_1_entity, save_1_user_resource, etc.
   - Много дублирования, но просто

7. **Вариант 2: Snapshots**:
   - Таблица `save_snapshot`: хранит JSON всех данных
   - При загрузке: парсить JSON и восстанавливать состояние
   - Меньше места, но сложнее

8. **Загрузка сохранений**:
   - Menu → Load Game
   - Список всех сохранений
   - Клик на слот → загрузить
   - Предупреждение: "Несохранённый прогресс будет потерян"

9. **UI меню сохранений**:
   - Список слотов (scrollable)
   - Для каждого слота:
     - Thumbnail (скриншот базы)
     - Название
     - Дата
     - Статистика (технологии, здания, время)
     - Кнопки: Load / Delete / Rename

   - Кнопка: "New Save" (сохранить в новый слот)

10. **Экспорт/импорт**:
    - Кнопка "Export Save"
    - Скачать файл save_game.json (или .bin)
    - Кнопка "Import Save"
    - Загрузить файл → добавить в слоты
    - Полезно для backup и переноса между устройствами

11. **Скриншоты** (опционально):
    - При сохранении: сделать скриншот текущего вида
    - Сохранить как thumbnail (200x150 px)
    - Показывать в списке сохранений
    - Помогает узнать сохранение

12. **Компрессия**:
    - Если данных много: gzip JSON
    - Уменьшает размер в 5-10 раз
    - Прозрачно для игрока

13. **Индикатор несохранённых изменений**:
    - После действий игрока: пометить "dirty"
    - Звёздочка (*) рядом с названием save
    - При попытке закрыть: "Есть несохранённые изменения!"

14. **Версионность**:
    - save_version: номер версии формата сохранений
    - При обновлении игры: миграция старых сохранений
    - Иначе: несовместимость
