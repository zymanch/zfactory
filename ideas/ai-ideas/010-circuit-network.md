# Логическая сеть (Circuit Network)

## Описание
Система логических сигналов для автоматизации и управления:
- Провода (красные, зелёные) соединяют здания
- Здания передают сигналы (количество ресурсов, состояние)
- Combinators (логические элементы): IF, AND, OR, математика
- Условия включения/выключения зданий
- Автоматическое управление производством

## Оценка сложности
**Очень высокая (10/10)**

- Новая система проводов (отдельно от электричества)
- Передача сигналов между зданиями
- Combinators (арифметические, логические, decider)
- UI для настройки условий
- Визуализация проводов и сигналов
- Оптимизация (обновление сети каждый тик)

## Оценка интересности
**Очень высокая (10/10)**

Для хардкорных игроков - бесконечная глубина. Позволяет создавать сложнейшие автоматические системы. Turing-complete логика!

## Краткий план реализации

1. **Провода**:
   - entity_type "Red Wire", "Green Wire"
   - Соединяют здания (drag от одного к другому)
   - Каждый провод = отдельная сеть
   - Здание может быть в красной И зелёной сети одновременно

2. **Сигналы**:
   - Каждый ресурс = уникальный сигнал
   - Виртуальные сигналы: A, B, C, ..., Z (для логики)
   - Специальные: "Everything", "Anything", "Each"
   - Формат: `{ signal_id: value }`

3. **Источники сигналов**:
   - **Chest**: передаёт содержимое (Iron Plate: 50)
   - **Assembler**: передаёт рецепт или инвентарь
   - **Train Station**: количество ресурсов в поезде
   - **Power Pole**: уровень энергии в сети
   - **Constant Combinator**: константные сигналы (настраиваются вручную)

4. **Combinators**:
   - **Arithmetic Combinator**: A + B = C, A * 2 = B, etc.
   - **Decider Combinator**: IF (Iron Plate > 100) THEN (Output = 1)
   - **Filter**: пропускает только определённые сигналы

5. **Условия зданий**:
   - Assembler: "Работать если Iron Plate < 1000"
   - Manipulator: "Включить если Coal > 50"
   - Pump: "Качать пока Water < 500"
   - Train Station: "Отправить поезд если Copper Plate > 10000"

6. **UI настройки**:
   - Клик на здание → вкладка "Circuit Network"
   - Выбор условия: signal, comparator (<, >, =, ≠), value
   - Для combinators: настройка операций

7. **Визуализация**:
   - Красные/зелёные провода (линии между зданиями)
   - Индикатор на здании (красный/зелёный светодиод)
   - Overlay режим: показать все сигналы в сети

8. **Примеры использования**:
   - **Автобалансировка**: если Iron Plate > 1000, остановить smelting
   - **Умный поезд**: отправлять только когда груз полон
   - **Приоритет**: если аккумуляторы < 20%, остановить несущественное производство
   - **Счётчики**: подсчитать сколько всего произведено ресурса

9. **База данных**:
   - Таблица `circuit_wire`: entity_from_id, entity_to_id, wire_color
   - entity: добавить поля:
     - circuit_condition (JSON): `{ signal, comparator, value }`
     - circuit_mode: "enable/disable", "read_contents", "set_recipe"

10. **Backend логика**:
    - Каждый тик:
      1. Собрать все сигналы от источников
      2. Пропустить через combinators
      3. Обновить состояния зданий (on/off) на основе условий
    - Оптимизация: обновлять только активные сети

11. **Продвинутое**:
    - **Speakers**: звуковые сигналы при условиях
    - **Display**: показывать значение сигнала на экране
    - **Programmable Combinator**: скриптовая логика (Lua?)
