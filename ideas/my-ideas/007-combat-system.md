# Боевая система

## Описание
Ввести оборонные башни (стреляют по врагам), башни починки (чинят здания в радиусе), вражеских юнитов и вражеские здания. Юниты могут атаковать и уничтожать постройки игрока.

## Оценка сложности
**Очень высокая (10/10)**

- Новая система юнитов (движение, AI, pathfinding)
- Система боя (атака, урон, HP)
- Анимация стрельбы, снарядов
- Система башен (таргетинг, приоритеты)
- Башни починки (лечение в радиусе)
- Спавн врагов (волны, триггеры)
- Вражеские постройки (спавнеры, препятствия)

## Оценка интересности
**Очень высокая (10/10)**

Добавляет экшен и challenge. Создаёт необходимость в обороне базы. Новый геймплейный цикл: производство → защита → расширение.

## Краткий план реализации

1. **База данных**:
   - Таблица `unit`: id, type_id, x, y, hp, target_entity_id, user_id (null = враг)
   - Таблица `unit_type`: id, name, hp, damage, speed, attack_range, sprite
   - entity_type: "Пушка", "Лазерная башня", "Башня починки"
   - Поля в entity: target_unit_id, attack_cooldown

2. **Backend (реалтайм)**:
   - Игровой цикл: обновление позиций юнитов (каждые 100ms)
   - AI юнитов: поиск ближайшей цели (A* pathfinding)
   - Атаки юнитов: урон entity, проверка уничтожения
   - Атаки башен: поиск целей в радиусе, стрельба
   - Башня починки: восстановление durability в радиусе

3. **Frontend**:
   - UnitRenderer.js: отрисовка юнитов
   - Анимация движения (интерполяция позиций)
   - Анимация атак (спрайты снарядов, взрывов)
   - HP бары над юнитами и башнями
   - Радиус действия башен (при выделении)

4. **Типы башен**:
   - **Пушка**: медленная, большой урон, средний радиус
   - **Лазерная**: быстрая, малый урон, большой радиус
   - **Починка**: лечит 5 HP/сек в радиусе 5 тайлов

5. **Типы врагов**:
   - **Гоблин**: быстрый, мало HP, слабая атака
   - **Орк**: медленный, много HP, сильная атака
   - **Летающий**: игнорирует препятствия

6. **Спавн врагов**:
   - Волнами (каждые 5 минут)
   - Из краёв карты или вражеских спавнеров
   - Сложность растёт с прогрессом

7. **Вражеские постройки**:
   - **Спавнер**: генерирует врагов
   - **Башня врага**: атакует игрока
   - Можно уничтожить (нужно много урона)

8. **Оптимизация**:
   - Обновлять только видимых юнитов на клиенте
   - Backend: обновлять всех (даже вне экрана)
   - WebSocket для real-time обновлений
