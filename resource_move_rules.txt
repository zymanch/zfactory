ОСНОВНЫЕ ПРАВИЛА ПО КОТОРЫМ ДОЛЖНА РАБОТАЕТ ИГРА:
- положить ресурс или взять ресурс из building, mining и storage может только манипулятор
- в building, mining манипулятор может положит только ресурсы которые являют исходными ресурсами в рецептах из этого entity.
- в building, mining манипулятор взять только ресурсы которые являют результатами крафта в рецептах из этого entity.
- в storage манипулятор может положить или взять любой ресурс
- если на конвеер передают ресурсы несколько конвееров, то преимущество складывания всегда имеет тот который имеет одинаковое с исходным конвеером orientation, боковые же конвееры передают ресурсы по очереди
- если на конвеер могут передать ресурс другой конвеер и манипулятор, приоритет имеет конвеер
- building, mining и storage просто хранят ресурсы, и когда картинка с ресурсом в них попадает она просто исчезает,
- если ресурс движеться в манипуляторе или конвеер - должна отображатся иконка ресурса и она должна двигатся
- манипулятор кладет ресурс в только в центр пустого конвеера, а забирать ресурс с конвеера может из любого места
- конвеер передает ресурс следующему конвееру только после того как ресурс полностью переместиться в конец конвеера.

ДАЛЬШЕ ИДЕТ ПРИМЕРНЫЙ ПЛАН РЕАЛИЗАЦИИ:

Для этого про пройдись в начале по каждому конвееру на карте (вообще все конвееры, а не отображаемые).
На конвеере может быть ресурс (логика с entity_resource). Ресурс может распологаться на конвеере слева, справа, сверху или снизу.
Каждый конвеер и манипулятор
1) может иметь 3 состояния: свободен, занят, в состоянии передачи ресурса другому.
2) должен иметь ссылка назначения (может быть null): иметь ссылку на следующий от него конвеер (учитывай orientation)
3) должен иметь ссылки источников: для конвееров это другие иметь конвееры которые в пункте 2 получили ссылку на текущий конвеер, для манипуляторов это здания или ресурсы, из которых манипулятор берет ресурсы (учитывай orientation)
4) должен иметь тип ресурса и его количество (в случае стопки) который он перемещает
При каждом размещении любого строения надо пересчитывать все ссылки.

Каждый entity должен иметь несколько методов (у нас уже есть разделение по entity_type):
1) примет ли он ресурс(аргумент resource_id). Может вернуть 3 состояния: "да", "нет", "да если освобожусь".
- если метод вызывается у building, если переданный аргумент ресурс является сырьем рецепта (input1_resource_id,input2_resource_id,input3_resource_id), и в данном entity меньше 10 ресурсов данного типа то ответ да, иначе нет
- если метод вызывается у манипулятора - если манипулятор свободен то ответ да, иначе нет
- если метод вызывается у relief, mining,resource,eye всегда отвечают нет
- если метод вызывается у transporter, если транспортер свободен то ответ да, если есть ресурс и он уже дошел до конца то ответа "да если освобжусь", иначе "нет"

2) "получить ресурс"(аргумент entity_type_id строения которому передаются ресурсы) который вернет тип ресурса и его количество, а у entity его уменьшит (те метод отбирает ресурс).
- метод вызывается у конвеера или манипулятора, а аргумент manipulator , данный метод должен отобрать ресурс в любом случае
- метод вызывается у конвеера или манипулятора, а аргумент transporter, метод может вернуть ресурсы только если ресурсы дошли до конца источника ресурса
- метод вызывается у манипулятора, а аргумент building, метод может отобрать ресурсы который является сырьем рецепта данного entity (input1_resource_id,input2_resource_id,input3_resource_id). Но а данном entity не должно быть больше 10 ресурсов данного вида.
- метод вызывается у mining,building, а аргумент manipulator , данный метод может отобрать ресурс только который является результатом рецепта данного entity (output_resource_id).
- в остальных случаях метод ничего не отбирает.

У каждого entity_type наверное стоит завести массив какие ресурсы можно брать или ложить в данный entity, чтобы не считать это каждый раз.

Состояние "да если освобжусь" нужно по 3 причинам:
1) того чтобы если к примеру манипуляторы выстроены по кольцу, и в каждом есть ресурс - то ресурсы двигались по кругу а не стояли на месте (так будет если у всех конвееров статус занят).
2) чтобы ресурсы двигались "паралельно". Иначе 1 тик у нас конвеер будет пустым хотя ресурс на него мог попасть сразу же.
3) чтобы манипулятор не успел

Вся работа должна происходить с помощью этих методов и свойств. Не используй entity.x,entity.y координаты.

Работа с движением ресурсов происходит при каждом тике.


С каждым тиком ресурс должен двигаться по конвееру по следующей логикой:
1) определяется направление конвеера (orientation)
2) если ресурс попал на конвеер сбоку, то вначале ресурс должен двигатся к центру конвеера (каждый тик двигаем по чуть чуть)
3) дальше он должен двигаться в направлении конвеера
4) скорость движения ресурса по конвееру определяется через entity_type.power
5) если ресурс доехал до конца конвеера и в ссылке назначения пусто либо занятый конвеер
- ресурс остается на месте в конце конвеера и дальше не двигается
6) если ресурс доехал до конца конвеера и в ссылке назначения пустой конвеер
- то ресурс переноситься в ссылку назначения
- если в ссылках источников есть конвеер который имеет orientation такой же как и текущий конвеер в состоянии "передачи ресурса другому", то у него переносим ресурс в текущий (рекурсивно - те у источника тоже есть источники которые тоже могут быть в состоянии "передачи ресурса другому")
- если в ссылках источников есть конвееры в состоянии "передачи ресурса другому", то у одного переносим ресурс в текущий. Сделай так чтобы каждый раз выбирался другой конвеер.
7) если ресурс доехал до конца конвеера и в ссылке назначения занятый конвеер, то текущий конвеер меняет состояние на "передачи ресурса другому"

Попытайся оптимизировать работу движения ресурса по конвееру и манипулятору, так как в секунду происходит 60 тиков а entity на карте может быть очень много.

Потом пройдись по всем конвеерам еще раз, и для всех конвееров в статусе "передачи ресурса другому" отмени передачу ресурсов.

Далее надо обработать работу манипуляторов:
1) если в манипуляторе нет ресурса, а в ссылке источника пусто, то ничего не делаем
2) если в манипуляторе нет ресурса, а в ссылке источнике нет ресурсов с type отличным от deposit, то ничего не делаем
3) если в манипуляторе нет ресурса, а в ссылке источнике есть ресурс с type отличным от deposit, то у источника уменьшаем первый попавшийся ресурс с type отличным от deposit на 1 (у источника удаляем ресурс если егок оличество равно 0), манипулятору присваиваем этот ресурс с количеством 1
4) если в манипуляторе есть ресурс, то двигаем его  в направлении orientation манипулятора до самого конца манипулятора
5) если в манипуляторе есть ресурс и он в самом конце, и в ссылке назначения пусто то передает ресурс. Если ресурсов хватает чтобы запустить 1 из рецептов то начинает процесс крафта. Ресурсы рецепта пропадают, и через некоторое количество тиков появляеться ресурс рецепта.
6) если в манипуляторе есть ресурс и он в самом конце, и в ссылке назначения занято то ресурс передавать нельзя. манипулятор ждет когда ему это разрешат
