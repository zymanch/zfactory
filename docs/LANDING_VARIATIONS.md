# Landing Variations System

## Структура

Каждый тип лендинга имеет папку с вариациями:

```
public/assets/tiles/landing/
├── grass/
│   ├── grass_0.png   (64x64 px)
│   ├── grass_1.png
│   ├── grass_2.png
│   ├── grass_3.png
│   └── grass_4.png
├── dirt/
│   ├── dirt_0.png
│   └── ...
└── ...
```

## Замена вариаций на качественные текстуры

1. Откройте папку нужного лендинга: `public/assets/tiles/landing/{name}/`
2. Замените PNG файлы на ваши качественные текстуры (64x64 px)
3. Перегенерируйте атласы: `php yii landing/generate`
4. Скомпилируйте assets: `npm run assets`

## Генерация атласов

Команда `php yii landing/generate` делает следующее:

1. Загружает готовые вариации из папок
2. Создает текстурный атлас для каждого лендинга
3. Добавляет волнистые переходы между разными типами лендингов
4. Сохраняет атласы в `public/assets/tiles/landing/atlases/`

## Параметры атласа

- **Padding**: 0px (не используется, вместо этого используется inset при рендеринге)
- **Inset при рендеринге**: 0.5px (предотвращает bleeding пикселей из соседних спрайтов)
- **Размер тайла**: 32x24 px
- **Вариации**: 5 на каждый лендинг (по умолчанию)

## Структура атласа

Атлас 11×12 (352×288 px) содержит все комбинации переходов:

```
Row 0: Вариации базового тайла (первые 5 колонок)
Row 1: Переходы когда сверху тот же лендинг (самоссылка)
Row 2-9: Переходы с разными лендингами сверху (landing_id 1-8)
Row 10: Переходы со sky сверху
Row 11: Переходы с island_edge сверху

Column 0: Самоссылка справа
Column 1-8: Разные лендинги справа (landing_id 1-8)
Column 9: Sky справа
Column 10: Island edge справа
```

## Формула координат

```javascript
// Особый случай: оба соседа совпадают - используем вариации из row 0
if (top === landingId && right === landingId) {
    row = 0;
    col = Math.floor(Math.random() * variationsCount);  // 0-4
}

// Иначе используем переходы:
// Row = сосед сверху + 1 (или sky_id + 1 если null)
// Col = сосед справа (или sky_id если null)
row = (top === null) ? 10 : (top + 1);
col = (right === null) ? 9 : right;

// Примеры:
// - Оба соседа Grass (id=1): row=0, col=random(0-4) - вариация
// - Sky сверху, Stone справа: row=10, col=5
// - Grass (id=1) сверху, Dirt (id=2) справа: row=2, col=2
// - Island Edge сверху (null→sky), справа пусто (null→sky): row=10, col=9
```

Используется `landing_id` напрямую, без таблицы `landing_adjacency`.

## Специальные правила Island Edge

В генераторе атласов (`LandingTransitionGenerator.php`) применяются специальные правила:

```php
// 1. Для Sky атласа: если сверху Island Edge, считаем что сверху Sky
if ($landingId == 9 && $topId == 10) {
    $topImage = $landingImages[9];
}

// 2. Для Island Edge атласа: если справа Sky, считаем что справа Island Edge
if ($landingId == 10 && $rightId == 9) {
    $rightImage = $landingImages[10];
}
```

**Цель:** Создать бесшовные переходы между Island Edge и Sky на краях парящего острова.

## Автоматическая генерация служебных тайлов

При загрузке карты автоматически добавляются:

**Island Edge (id=10):**
- Добавляется **снизу** от каждого non-sky тайла, если снизу пусто или sky
- Создает визуальный край парящего острова

**Sky (id=9):**
- Добавляется **слева** от каждого non-sky тайла, если слева пусто
- Обеспечивает правильные переходы с левого края карты

## Параметры волнистых линий

Переходы генерируются с использованием косинусной функции:

```php
$waveAmplitude = 1;     // Амплитуда волны в пикселях
$waveFrequency = 2.0;   // Количество волн на тайл
$outlineWidth = 1;      // Ширина затемненной границы

// Формула (пример для правого края):
$wave = cos($t * 2 * M_PI * $waveFrequency) * $waveAmplitude;
$wavyX[$y] = (int)round($tileWidth - 1 - $waveAmplitude + $wave);
```

**Типы переходов:**
- Правый край: вертикальная волнистая линия справа
- Верхний край: горизонтальная волнистая линия сверху
- Угол: L-образная волнистая линия (оба края)

## Рандомизация

Вариации автоматически рандомизируются для:
- Тайлов без переходов (оба соседа совпадают с текущим лендингом)
- Тайлов в центре больших областей

Это создает естественную вариативность ландшафта.

## Генерация красивых спрайтов для лендингов

### Рекомендуемые инструменты

#### 1. **AI Генераторы (лучший вариант для быстрого результата)**

**Midjourney / DALL-E / Stable Diffusion:**
```
Промпт шаблон:
"seamless tileable texture, 64x64 pixel art, [тип текстуры],
top-down view, isometric perspective, game asset,
pixel perfect, no borders, repeatable pattern"

Примеры:
- "seamless tileable texture, 64x64 pixel art, grass field,
   top-down view, bright green, game asset"
- "seamless tileable texture, 64x64 pixel art, dirt ground,
   brown earth, top-down view, game tile"
- "seamless tileable texture, 64x64 pixel art, sand beach,
   yellow beige, desert texture, game asset"
```

**Важно:**
- Указывайте "seamless" и "tileable" для бесшовности
- "pixel art" даст пиксельную стилистику
- "64x64" - точный размер (но AI может не соблюсти, потребуется resize)

#### 2. **Pixelart редакторы (для ручной работы)**

**Aseprite** (рекомендуется):
- Профессиональный pixelart редактор
- Onion skinning для анимаций
- Tile mode для проверки повторяемости
- Export в PNG
- Цена: $19.99 или бесплатно (компиляция из исходников)

**Piskel** (бесплатно):
- Онлайн редактор: https://www.piskelapp.com
- Простой интерфейс
- Tile preview mode
- Export в PNG

**GIMP / Photoshop** (для обработки):
- Фильтры для текстур
- Tile offset для проверки бесшовности
- Масштабирование с pixel-perfect алгоритмами

#### 3. **Процедурная генерация текстур**

**Genetica / Filter Forge:**
- Генерация бесшовных текстур
- Настройка параметров (цвет, шум, детализация)
- Export в нужный размер

**Онлайн генераторы:**
- https://www.texturemate.com
- https://cpetry.github.io/TextureGenerator-Online/
- https://www.filterforge.com/filters/

### Рекомендации по созданию текстур

#### Общие правила:

1. **Размер:** Строго 64×64 пикселя (без исключений!)

2. **Бесшовность (Seamless Tiling):**
   - Левый край должен совпадать с правым
   - Верхний край должен совпадать с нижним
   - Проверка: скопируйте текстуру 3×3 - не должно быть видимых швов

3. **Цветовая палитра:**
   - Используйте 8-16 цветов на текстуру
   - Избегайте градиентов (используйте dithering вместо этого)
   - Контрастные цвета для читаемости

4. **Детализация:**
   - На 64×64 пикселях не помещается много деталей
   - Используйте крупные пиксельные блоки (2×2, 3×3)
   - Меньше деталей = лучше читаемость

5. **Вариативность:**
   - Создайте 5 вариаций для каждого типа
   - Небольшие различия: смещение травинок, другой узор камней
   - Одна палитра для всех вариаций

#### Примеры техник:

**Grass (трава):**
```
Основа: светло-зеленый (#7EC850)
Тени: темно-зеленый (#4F8040)
Детали: желто-зеленые травинки (#A0D860)
Техника: dithering для перехода цветов, случайные пиксели травы
```

**Dirt (земля):**
```
Основа: коричневый (#8B6914)
Тени: темно-коричневый (#6B4810)
Детали: светло-коричневые камешки (#A48030)
Техника: шумовая текстура, неравномерность
```

**Water (вода):**
```
Основа: синий (#4A90E2)
Тени: темно-синий (#2E5A8E)
Блики: светло-голубой (#6BB6FF)
Техника: горизонтальные волны, dithering для глубины
```

**Stone (камень):**
```
Основа: серый (#808080)
Тени: темно-серый (#505050)
Детали: светло-серые трещины (#A0A0A0)
Техника: крупные блоки, случайные трещины
```

#### Workflow для AI генерации:

1. **Генерируйте в большом разрешении** (256×192 или больше)
2. **Downscale с nearest neighbor** до 64×64
3. **Проверьте бесшовность:**
   - GIMP: Filters → Map → Tile (создает превью)
   - Photoshop: Filter → Other → Offset (сдвиг на 50%)
4. **Исправьте швы вручную** в pixelart редакторе
5. **Создайте 5 вариаций:**
   - Rotate hue (±5-10°)
   - Add noise (+3-5%)
   - Shift pattern (offset на 1-2 пикселя)

#### Тестирование:

```bash
# 1. Замените файлы в папке
cp my_grass_*.png public/assets/tiles/landing/grass/

# 2. Перегенерируйте атласы
php yii landing/generate

# 3. Скомпилируйте JS
npm run assets

# 4. Проверьте в браузере (Ctrl+F5 для сброса кеша)
```

### Готовые ресурсы

**Бесплатные Pixelart Tilesets:**
- https://opengameart.org (тег: "terrain", "tileset", "64x64" или "isometric")
- https://itch.io/game-assets/free/tag-tileset
- https://kenney.nl/assets (надо будет нарезать и адаптировать)

**Платные:**
- https://craftpix.net
- https://graphicriver.net

**Важно:** Проверяйте лицензию перед использованием!
