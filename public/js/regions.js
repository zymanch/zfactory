/*! For license information please see regions.js.LICENSE.txt */
!function(){function t(e){return t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},t(e)}function e(t){return function(t){if(Array.isArray(t))return r(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||n(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function i(t,e){var i="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!i){if(Array.isArray(t)||(i=n(t))||e&&t&&"number"==typeof t.length){i&&(t=i);var r=0,o=function(){};return{s:o,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,s=!0,c=!1;return{s:function(){i=i.call(t)},n:function(){var t=i.next();return s=t.done,t},e:function(t){c=!0,a=t},f:function(){try{s||null==i.return||i.return()}finally{if(c)throw a}}}}function n(t,e){if(t){if("string"==typeof t)return r(t,e);var i={}.toString.call(t).slice(8,-1);return"Object"===i&&t.constructor&&(i=t.constructor.name),"Map"===i||"Set"===i?Array.from(t):"Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?r(t,e):void 0}}function r(t,e){(null==e||e>t.length)&&(e=t.length);for(var i=0,n=Array(e);i<e;i++)n[i]=t[i];return n}function o(){var t,e,i="function"==typeof Symbol?Symbol:{},n=i.iterator||"@@iterator",r=i.toStringTag||"@@toStringTag";function s(i,n,r,o){var s=n&&n.prototype instanceof u?n:u,l=Object.create(s.prototype);return a(l,"_invoke",function(i,n,r){var o,a,s,u=0,l=r||[],h=!1,f={p:0,n:0,v:t,a:d,f:d.bind(t,4),d:function(e,i){return o=e,a=0,s=t,f.n=i,c}};function d(i,n){for(a=i,s=n,e=0;!h&&u&&!r&&e<l.length;e++){var r,o=l[e],d=f.p,v=o[2];i>3?(r=v===n)&&(s=o[(a=o[4])?5:(a=3,3)],o[4]=o[5]=t):o[0]<=d&&((r=i<2&&d<o[1])?(a=0,f.v=n,f.n=o[1]):d<v&&(r=i<3||o[0]>n||n>v)&&(o[4]=i,o[5]=n,f.n=v,a=0))}if(r||i>1)return c;throw h=!0,n}return function(r,l,v){if(u>1)throw TypeError("Generator is already running");for(h&&1===l&&d(l,v),a=l,s=v;(e=a<2?t:s)||!h;){o||(a?a<3?(a>1&&(f.n=-1),d(a,s)):f.n=s:f.v=s);try{if(u=2,o){if(a||(r="next"),e=o[r]){if(!(e=e.call(o,s)))throw TypeError("iterator result is not an object");if(!e.done)return e;s=e.value,a<2&&(a=0)}else 1===a&&(e=o.return)&&e.call(o),a<2&&(s=TypeError("The iterator does not provide a '"+r+"' method"),a=1);o=t}else if((e=(h=f.n<0)?s:i.call(n,f))!==c)break}catch(e){o=t,a=1,s=e}finally{u=1}}return{value:e,done:h}}}(i,r,o),!0),l}var c={};function u(){}function l(){}function h(){}e=Object.getPrototypeOf;var f=[][n]?e(e([][n]())):(a(e={},n,function(){return this}),e),d=h.prototype=u.prototype=Object.create(f);function v(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,h):(t.__proto__=h,a(t,r,"GeneratorFunction")),t.prototype=Object.create(d),t}return l.prototype=h,a(d,"constructor",h),a(h,"constructor",l),l.displayName="GeneratorFunction",a(h,r,"GeneratorFunction"),a(d),a(d,r,"Generator"),a(d,n,function(){return this}),a(d,"toString",function(){return"[object Generator]"}),(o=function(){return{w:s,m:v}})()}function a(t,e,i,n){var r=Object.defineProperty;try{r({},"",{})}catch(t){r=0}a=function(t,e,i,n){function o(e,i){a(t,e,function(t){return this._invoke(e,i,t)})}e?r?r(t,e,{value:i,enumerable:!n,configurable:!n,writable:!n}):t[e]=i:(o("next",0),o("throw",1),o("return",2))},a(t,e,i,n)}function s(t,e,i,n,r,o,a){try{var s=t[o](a),c=s.value}catch(t){return void i(t)}s.done?e(c):Promise.resolve(c).then(n,r)}function c(t){return function(){var e=this,i=arguments;return new Promise(function(n,r){var o=t.apply(e,i);function a(t){s(o,n,r,a,c,"next",t)}function c(t){s(o,n,r,a,c,"throw",t)}a(void 0)})}}function u(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,l(n.key),n)}}function l(e){var i=function(e,i){if("object"!=t(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,i||"default");if("object"!=t(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===i?String:Number)(e)}(e,"string");return"symbol"==t(i)?i:i+""}var h=function(){return t=function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.regions=[],this.currentRegionId=null,this.shipViewRadius=300,this.shipJumpDistance=500,this.mapCanvas=document.getElementById("regions-map"),this.ctx=this.mapCanvas.getContext("2d"),this.viewportX=0,this.viewportY=0,this.zoom=1,this.images={},this.tooltip=document.getElementById("region-tooltip"),this.init()},n=[{key:"init",value:(h=c(o().m(function t(){var e=this;return o().w(function(t){for(;;)switch(t.n){case 0:return this.resizeCanvas(),window.addEventListener("resize",function(){return e.resizeCanvas()}),t.n=1,this.loadRegions();case 1:this.setupMouseEvents(),this.render();case 2:return t.a(2)}},t,this)})),function(){return h.apply(this,arguments)})},{key:"resizeCanvas",value:function(){var t=document.getElementById("regions-sidebar").offsetWidth;this.mapCanvas.width=window.innerWidth-t,this.mapCanvas.height=window.innerHeight,this.render()}},{key:"loadRegions",value:(l=c(o().m(function t(){var e,i,n,r;return o().w(function(t){for(;;)switch(t.p=t.n){case 0:return t.p=0,t.n=1,fetch("/regions/list",{method:"GET",headers:{"Content-Type":"application/json"}});case 1:return e=t.v,t.n=2,e.json();case 2:if("ok"!==(i=t.v).result){t.n=4;break}return this.regions=i.regions,this.currentRegionId=i.current_region_id,this.shipViewRadius=i.ship_view_radius,this.shipJumpDistance=i.ship_jump_distance,document.getElementById("ship-view-radius").textContent=this.shipViewRadius,document.getElementById("ship-jump-distance").textContent=this.shipJumpDistance,(n=this.regions.find(function(t){return t.is_current}))&&(this.viewportX=-n.x*this.zoom+this.mapCanvas.width/2,this.viewportY=-n.y*this.zoom+this.mapCanvas.height/2),t.n=3,this.loadImages();case 3:this.renderRegionsList(),console.log("[Regions] Loaded",this.regions.length,"regions"),t.n=5;break;case 4:console.error("[Regions] Failed to load:",i.message);case 5:t.n=7;break;case 6:t.p=6,r=t.v,console.error("[Regions] Load error:",r);case 7:return t.a(2)}},t,this,[[0,6]])})),function(){return l.apply(this,arguments)})},{key:"loadImages",value:(s=c(o().m(function t(){var e,i=this;return o().w(function(t){for(;;)switch(t.n){case 0:return e=this.regions.map(function(t){return new Promise(function(e){var n=new Image;n.onload=function(){i.images[t.region_id]=n,e()},n.onerror=function(){return e()},n.src="/assets/images/regions/".concat(t.image_url)})}),t.n=1,Promise.all(e);case 1:return t.a(2)}},t,this)})),function(){return s.apply(this,arguments)})},{key:"setupMouseEvents",value:function(){var t=this,e=!1,i=0,n=0;this.mapCanvas.addEventListener("mousedown",function(t){e=!0,i=t.clientX,n=t.clientY}),this.mapCanvas.addEventListener("mousemove",function(r){if(e){var o=r.clientX-i,a=r.clientY-n;t.viewportX+=o,t.viewportY+=a,i=r.clientX,n=r.clientY,t.render()}else t.showTooltip(r)}),this.mapCanvas.addEventListener("mouseup",function(){e=!1}),this.mapCanvas.addEventListener("mouseleave",function(){e=!1,t.hideTooltip()}),this.mapCanvas.addEventListener("click",function(i){e||t.handleClick(i)}),this.mapCanvas.addEventListener("wheel",function(e){e.preventDefault();var i=e.deltaY>0?.9:1.1,n=t.zoom;t.zoom*=i,t.zoom=Math.max(.3,Math.min(2,t.zoom));var r=t.mapCanvas.getBoundingClientRect(),o=e.clientX-r.left,a=e.clientY-r.top,s=t.zoom/n;t.viewportX=o-(o-t.viewportX)*s,t.viewportY=a-(a-t.viewportY)*s,t.render()})}},{key:"render",value:function(){this.ctx.clearRect(0,0,this.mapCanvas.width,this.mapCanvas.height),this.ctx.fillStyle="#1a1a2e",this.ctx.fillRect(0,0,this.mapCanvas.width,this.mapCanvas.height),this.drawGrid();var t,e=i(this.regions);try{for(e.s();!(t=e.n()).done;){var n=t.value;this.drawRegion(n)}}catch(t){e.e(t)}finally{e.f()}this.drawConnections(),this.drawFogOfWar()}},{key:"drawGrid",value:function(){this.ctx.strokeStyle="rgba(255, 255, 255, 0.05)",this.ctx.lineWidth=1;for(var t=500*this.zoom,e=Math.floor(-this.viewportX/t)*t,i=Math.floor(-this.viewportY/t)*t,n=e;n<this.mapCanvas.width;n+=t)this.ctx.beginPath(),this.ctx.moveTo(n+this.viewportX,0),this.ctx.lineTo(n+this.viewportX,this.mapCanvas.height),this.ctx.stroke();for(var r=i;r<this.mapCanvas.height;r+=t)this.ctx.beginPath(),this.ctx.moveTo(0,r+this.viewportY),this.ctx.lineTo(this.mapCanvas.width,r+this.viewportY),this.ctx.stroke()}},{key:"drawRegion",value:function(t){var e=t.x*this.zoom+this.viewportX,i=t.y*this.zoom+this.viewportY,n=80*this.zoom,r=this.images[t.region_id];r?(this.ctx.save(),this.ctx.globalAlpha=t.is_current?1:.9,this.ctx.drawImage(r,e-n/2,i-n/2,n,n),this.ctx.restore()):(this.ctx.fillStyle=["#8BC34A","#FFC107","#FF9800","#F44336","#9C27B0"][t.difficulty-1]||"#888",this.ctx.beginPath(),this.ctx.arc(e,i,n/2,0,2*Math.PI),this.ctx.fill()),t.is_current&&(this.ctx.strokeStyle="#4CAF50",this.ctx.lineWidth=3,this.ctx.beginPath(),this.ctx.arc(e,i,n/2+5,0,2*Math.PI),this.ctx.stroke()),this.ctx.fillStyle="#ffffff",this.ctx.font="".concat(12*this.zoom,"px Arial"),this.ctx.textAlign="center",this.ctx.fillText(t.name,e,i+n/2+15*this.zoom)}},{key:"drawConnections",value:function(){var t=this,e=this.regions.find(function(t){return t.is_current});if(e){var n,r=e.x*this.zoom+this.viewportX,o=e.y*this.zoom+this.viewportY,a=i(this.regions);try{for(a.s();!(n=a.n()).done;){var s=n.value;if(!s.is_current&&s.can_travel){var c=s.x*this.zoom+this.viewportX,u=s.y*this.zoom+this.viewportY;this.ctx.strokeStyle="rgba(76, 175, 80, 0.3)",this.ctx.lineWidth=2,this.ctx.setLineDash([5,5]),this.ctx.beginPath(),this.ctx.moveTo(r,o),this.ctx.lineTo(c,u),this.ctx.stroke(),this.ctx.setLineDash([])}}}catch(t){a.e(t)}finally{a.f()}var l,h=i(this.regions);try{var f=function(){var e=l.value;if(!e.is_visited||!e.from_region_id)return 0;var i=t.regions.find(function(t){return t.region_id===e.from_region_id});if(!i)return 0;var n=i.x*t.zoom+t.viewportX,r=i.y*t.zoom+t.viewportY,o=e.x*t.zoom+t.viewportX,a=e.y*t.zoom+t.viewportY;t.ctx.strokeStyle="rgba(255, 193, 7, 0.8)",t.ctx.lineWidth=3,t.ctx.setLineDash([]),t.ctx.beginPath(),t.ctx.moveTo(n,r),t.ctx.lineTo(o,a),t.ctx.stroke()};for(h.s();!(l=h.n()).done;)f()}catch(t){h.e(t)}finally{h.f()}}}},{key:"drawFogOfWar",value:function(){var t=this.regions.find(function(t){return t.is_current});if(t){var e=document.createElement("canvas");e.width=this.mapCanvas.width,e.height=this.mapCanvas.height;var n=e.getContext("2d");n.fillStyle="rgba(0, 0, 0, 0.95)",n.fillRect(0,0,e.width,e.height),n.globalCompositeOperation="destination-out";var r=t.x*this.zoom+this.viewportX,o=t.y*this.zoom+this.viewportY,a=this.shipViewRadius*this.zoom,s=n.createRadialGradient(r,o,.85*a,r,o,1.2*a);s.addColorStop(0,"rgba(255, 255, 255, 1)"),s.addColorStop(.5,"rgba(255, 255, 255, 0.7)"),s.addColorStop(1,"rgba(255, 255, 255, 0)"),n.fillStyle=s,n.fillRect(0,0,e.width,e.height);var c,u=i(this.regions);try{for(u.s();!(c=u.n()).done;){var l=c.value;if(l.is_visited&&!l.is_current&&l.visited_view_radius>0){var h=l.x*this.zoom+this.viewportX,f=l.y*this.zoom+this.viewportY,d=l.visited_view_radius*this.zoom,v=n.createRadialGradient(h,f,.85*d,h,f,1.2*d);v.addColorStop(0,"rgba(255, 255, 255, 1)"),v.addColorStop(.5,"rgba(255, 255, 255, 0.7)"),v.addColorStop(1,"rgba(255, 255, 255, 0)"),n.fillStyle=v,n.beginPath(),n.arc(h,f,1.2*d,0,2*Math.PI),n.fill()}}}catch(t){u.e(t)}finally{u.f()}this.ctx.drawImage(e,0,0)}}},{key:"showTooltip",value:function(t){var e=this.getRegionAtMouse(t);e?(this.tooltip.classList.remove("hidden"),this.tooltip.style.left=t.clientX+10+"px",this.tooltip.style.top=t.clientY+10+"px",document.getElementById("tooltip-name").textContent=e.name,document.getElementById("tooltip-distance").textContent="Distance: ".concat(e.distance),document.getElementById("tooltip-difficulty").textContent="Difficulty: ".concat(e.difficulty),document.getElementById("tooltip-resources").innerHTML=e.resources||"No resources",document.getElementById("tooltip-status").textContent=e.is_current?"Current Location":e.can_travel?"Can Travel":"Too Far"):this.hideTooltip()}},{key:"hideTooltip",value:function(){this.tooltip.classList.add("hidden")}},{key:"handleClick",value:function(t){var e=this.getRegionAtMouse(t);e&&e.can_travel&&!e.is_current&&this.travelToRegion(e.region_id)}},{key:"getRegionAtMouse",value:function(t){var e,n=this.mapCanvas.getBoundingClientRect(),r=t.clientX-n.left,o=t.clientY-n.top,a=i(this.regions);try{for(a.s();!(e=a.n()).done;){var s=e.value,c=s.x*this.zoom+this.viewportX,u=s.y*this.zoom+this.viewportY,l=80*this.zoom,h=r-c,f=o-u;if(Math.sqrt(h*h+f*f)<l/2)return s}}catch(t){a.e(t)}finally{a.f()}return null}},{key:"travelToRegion",value:(a=c(o().m(function t(e){var i,n,r;return o().w(function(t){for(;;)switch(t.p=t.n){case 0:return t.p=0,t.n=1,fetch("/regions/travel",{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-Token":this.getCSRFToken()},body:JSON.stringify({region_id:e})});case 1:return i=t.v,t.n=2,i.json();case 2:"ok"===(n=t.v).result?(console.log("[Regions] Traveled:",n.message),window.location.href="/game"):(console.error("[Regions] Travel failed:",n.message),alert(n.message)),t.n=4;break;case 3:t.p=3,r=t.v,console.error("[Regions] Travel error:",r);case 4:return t.a(2)}},t,this,[[0,3]])})),function(t){return a.apply(this,arguments)})},{key:"renderRegionsList",value:function(){var t=this,n=document.getElementById("regions-list");n.innerHTML="";var r,o=i(e(this.regions).sort(function(t,e){return t.distance-e.distance}));try{var a=function(){var e=r.value,i=document.createElement("div");i.className="region-item",e.is_current&&i.classList.add("current"),e.can_travel||e.is_current||i.classList.add("disabled"),i.innerHTML='\n                <div class="region-name">'.concat(e.name,'</div>\n                <div class="region-distance">Distance: ').concat(e.distance,'</div>\n                <div class="region-difficulty">Difficulty: ').concat("â˜…".repeat(e.difficulty),"</div>\n            "),e.can_travel&&!e.is_current&&(i.style.cursor="pointer",i.addEventListener("click",function(){return t.travelToRegion(e.region_id)})),n.appendChild(i)};for(o.s();!(r=o.n()).done;)a()}catch(t){o.e(t)}finally{o.f()}}},{key:"getCSRFToken",value:function(){var t;return(null===(t=document.querySelector('meta[name="csrf-token"]'))||void 0===t?void 0:t.getAttribute("content"))||""}}],n&&u(t.prototype,n),r&&u(t,r),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,n,r,a,s,l,h}();document.addEventListener("DOMContentLoaded",function(){window.regionsApp=new h})}();